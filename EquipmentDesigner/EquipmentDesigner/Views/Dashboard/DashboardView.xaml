<UserControl x:Class="EquipmentDesigner.Views.DashboardView"
             x:Name="DashboardRoot"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:lex="http://wpflocalizeextension.codeplex.com"
             xmlns:services="clr-namespace:EquipmentDesigner.Services"
             xmlns:converters="clr-namespace:EquipmentDesigner.Converters"
             xmlns:controls="clr-namespace:EquipmentDesigner.Controls"
             lex:LocalizeDictionary.DesignCulture="ko"
             lex:ResxLocalizationProvider.DefaultAssembly="EquipmentDesigner"
             lex:ResxLocalizationProvider.DefaultDictionary="Resources.Strings"
             mc:Ignorable="d"
             Background="{StaticResource Brush.Background.Primary}"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ComponentStateToBackgroundConverter x:Key="ComponentStateToBackgroundConverter"/>
        <converters:ComponentStateToForegroundConverter x:Key="ComponentStateToForegroundConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Bar with Language Selector -->
        <Border Grid.Row="0"
                Background="{StaticResource Brush.Surface.Primary}"
                BorderBrush="{StaticResource Brush.Border.Primary}"
                BorderThickness="0,0,0,1"
                Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Header Section -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{lex:Loc Key=Dashboard_Title}"
                            Style="{StaticResource Typography.H3}"
                            Foreground="{StaticResource Brush.Text.Primary}"/>
                    <TextBlock Text="{lex:Loc Key=Dashboard_Subtitle}"
                            Style="{StaticResource Typography.Body.Large}"
                            Foreground="{StaticResource Brush.Text.Secondary}"
                            Margin="0,8,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1"/>

                <!-- Language Selector -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{lex:Loc Key=Language}"
                            Style="{StaticResource Typography.Body}"
                            Foreground="{StaticResource Brush.Text.Secondary}"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0"/>
                    <ComboBox Style="{StaticResource LanguageSelectorComboBox}"
                                ItemsSource="{Binding Source={x:Static services:LanguageService.Instance}, Path=AvailableLanguages}"
                                SelectedItem="{Binding Source={x:Static services:LanguageService.Instance}, Path=SelectedLanguage, Mode=TwoWay}"
                                DisplayMemberPath="DisplayName"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="{StaticResource Spacing.Padding.2XL}">
                <!-- Admin Mode Panel (Hidden by default, toggle with Ctrl+Shift+F10) -->
                <Border Background="{StaticResource Brush.Surface.Primary}"
                        BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                        BorderThickness="2"
                        CornerRadius="{StaticResource Radius.LG}"
                        Padding="16"
                        Margin="0,0,0,16"
                        Visibility="{Binding IsAdminModeVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                        MouseRightButtonUp="AdminPanel_MouseRightButtonUp">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Admin Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                            <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2v-2zm1-10c-1.66 0-3 1.34-3 3h2c0-.55.45-1 1-1s1 .45 1 1c0 1-1.5 1.25-1.5 3.5h2c0-1.5 1.5-1.75 1.5-3.5 0-1.66-1.34-3-3-3z"
                                  Fill="{StaticResource Brush.Status.Danger}"
                                  Width="20" Height="20"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Admin Mode"
                                       Style="{StaticResource Typography.Body.Large}"
                                       FontWeight="{StaticResource Font.Weight.SemiBold}"
                                       Foreground="{StaticResource Brush.Status.Danger}"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="(Ctrl+Shift+F10 to hide)"
                                       Style="{StaticResource Typography.Body.Small}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       VerticalAlignment="Center"
                                       Margin="12,0,0,0"/>
                        </StackPanel>

                        <!-- Admin Actions - WrapPanel for extensibility -->
                        <WrapPanel Grid.Row="1" Orientation="Horizontal">
                            <Button Command="{Binding DeleteAllIncompleteWorkflowsCommand}"
                                    Background="{StaticResource Brush.Status.Danger.Background}"
                                    BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                    BorderThickness="{StaticResource Border.Thin}"
                                    Padding="12,8"
                                    Margin="0,0,8,8"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{StaticResource Brush.Status.Danger.Background}"
                                                            BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                                            BorderThickness="{StaticResource Border.Thin}"
                                                            CornerRadius="{StaticResource Radius.MD}"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource Brush.Status.Danger.Border}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.5"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                          Fill="{StaticResource Brush.Status.Danger}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Delete All Incomplete Workflows"
                                               Style="{StaticResource Typography.Body}"
                                               Foreground="{StaticResource Brush.Status.Danger}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- Reset All Data Button -->
                            <Button Command="{Binding ResetAllDataCommand}"
                                    Background="{StaticResource Brush.Status.Danger.Background}"
                                    BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                    BorderThickness="{StaticResource Border.Thin}"
                                    Padding="12,8"
                                    Margin="0,0,8,8"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{StaticResource Brush.Status.Danger.Background}"
                                                            BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                                            BorderThickness="{StaticResource Border.Thin}"
                                                            CornerRadius="{StaticResource Radius.MD}"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource Brush.Status.Danger.Border}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.5"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                          Fill="{StaticResource Brush.Status.Danger}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Reset All Data"
                                               Style="{StaticResource Typography.Body}"
                                               Foreground="{StaticResource Brush.Status.Danger}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>
                    </Grid>
                </Border>

                <!-- Incomplete Workflows Section -->
                <Border Background="{StaticResource Brush.Status.Warning.Background}"
                        BorderBrush="{StaticResource Brush.Status.Warning.Border}"
                        BorderThickness="{StaticResource Border.Thin}"
                        CornerRadius="{StaticResource Radius.LG}"
                        Padding="16"
                        Margin="0,0,0,32"
                        Visibility="{Binding HasIncompleteWorkflows, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Warning Icon -->
                        <Path Grid.Column="0"
                              Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                              Fill="{StaticResource Brush.Status.Warning}"
                              Width="20" Height="20"
                              Stretch="Uniform"
                              VerticalAlignment="Top"
                              Margin="0,2,12,0"/>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="{lex:Loc Key=Dashboard_IncompleteWorkflows}"
                                       Style="{StaticResource Typography.Body.Large}"
                                       Foreground="{StaticResource Brush.Status.Warning}"
                                       FontWeight="{StaticResource Font.Weight.Medium}"/>
                            <TextBlock Text="{Binding IncompleteWorkflowsMessage}"
                                       Style="{StaticResource Typography.Body.Large}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       Margin="0,4,0,16"/>

                            <!-- Workflow Items List -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="256">
                                <ItemsControl ItemsSource="{Binding IncompleteWorkflows}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <controls:DefaultWhiteCard Command="{Binding DataContext.ResumeWorkflowCommand, ElementName=DashboardRoot}"
                                                                       CommandParameter="{Binding}"
                                                                       CardPadding="12"
                                                                       CardCornerRadius="{StaticResource Radius.LG}"
                                                                       Margin="0,0,0,8">
                                                <controls:DefaultWhiteCard.CardContent>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding StartedFrom}"
                                                                       Style="{StaticResource Typography.Body.Large}"
                                                                       Foreground="{StaticResource Brush.Text.Primary}"/>
                                                            <controls:StateChip Text="{Binding ComponentStateDisplayText}"
                                                                                ChipBackground="{Binding ComponentState, Converter={StaticResource ComponentStateToBackgroundConverter}}"
                                                                                ChipForeground="{Binding ComponentState, Converter={StaticResource ComponentStateToForegroundConverter}}"
                                                                                Margin="12,0,0,0"/>
                                                        </StackPanel>
                                                        <TextBlock Grid.Column="1"
                                                                   Text="{Binding Date}"
                                                                   Style="{StaticResource Typography.Body.Large}"
                                                                   Foreground="{StaticResource Brush.Text.Secondary}"
                                                                   VerticalAlignment="Center"/>

                                                        <!-- Delete Button (visible on hover) -->
                                                        <Button Grid.Column="2"
                                                                Command="{Binding DataContext.DeleteWorkflowCommand, ElementName=DashboardRoot}"
                                                                CommandParameter="{Binding}"
                                                                Background="Transparent"
                                                                BorderThickness="0"
                                                                Cursor="Hand"
                                                                Padding="6"
                                                                Margin="8,0,0,0"
                                                                VerticalAlignment="Center"
                                                                ToolTip="{lex:Loc Key=DeleteWorkflow_Tooltip}">
                                                            <Button.Style>
                                                                <Style TargetType="Button">
                                                                    <Setter Property="Opacity" Value="0"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=controls:DefaultWhiteCard}}" Value="True">
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </DataTrigger>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </Trigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Button.Style>
                                                            <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                                                  Fill="{StaticResource Brush.Text.Secondary}"
                                                                  Width="16" Height="16"
                                                                  Stretch="Uniform"/>
                                                        </Button>
                                                    </Grid>
                                                </controls:DefaultWhiteCard.CardContent>
                                            </controls:DefaultWhiteCard>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Navigation Cards Section -->
                <UniformGrid Rows="1" Columns="2" Margin="0,0,0,32">
                    <!-- Start from Scratch Card -->
                    <controls:DefaultWhiteCard Command="{Binding NavigateToCreateNewComponentCommand}"
                                               CardPadding="32"
                                               CardCornerRadius="{StaticResource Radius.LG}"
                                               Margin="0,0,12,0">
                        <controls:DefaultWhiteCard.CardContent>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <!-- Icon Circle (Blue Background) -->
                                <Border Background="{StaticResource Brush.Status.Info.Background}"
                                        Width="64" Height="64"
                                        CornerRadius="{StaticResource Radius.Full}"
                                        HorizontalAlignment="Center">
                                    <Path Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                          Fill="{StaticResource Brush.Status.Info}"
                                          Width="32" Height="32"
                                          Stretch="Uniform"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="{lex:Loc Key=Dashboard_StartFromScratch}"
                                           Style="{StaticResource Typography.H4}"
                                           Foreground="{StaticResource Brush.Text.Primary}"
                                           HorizontalAlignment="Center"
                                           Margin="0,16,0,0"/>
                                <TextBlock Text="{lex:Loc Key=Dashboard_StartFromScratch_Description}"
                                           Style="{StaticResource Typography.Body}"
                                           Foreground="{StaticResource Brush.Text.Secondary}"
                                           HorizontalAlignment="Center"
                                           TextAlignment="Center"
                                           Margin="0,8,0,0"/>
                            </StackPanel>
                        </controls:DefaultWhiteCard.CardContent>
                    </controls:DefaultWhiteCard>

                    <!-- Start from Existing Hardwares Card -->
                    <controls:DefaultWhiteCard Command="{Binding NavigateToComponentListCommand}"
                                               CardPadding="32"
                                               CardCornerRadius="{StaticResource Radius.LG}"
                                               Margin="12,0,0,0">
                        <controls:DefaultWhiteCard.CardContent>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <!-- Icon Circle (Green Background) -->
                                <Border Background="{StaticResource Brush.Status.Success.Background}"
                                        Width="64" Height="64"
                                        CornerRadius="{StaticResource Radius.Full}"
                                        HorizontalAlignment="Center">
                                    <Path Data="M21 8.00002C20.9996 7.6493 20.9071 7.30483 20.7315 7.00119C20.556 6.69754 20.3037 6.44539 20 6.27002L13 2.27002C12.696 2.09449 12.3511 2.00208 12 2.00208C11.6489 2.00208 11.304 2.09449 11 2.27002L4 6.27002C3.69626 6.44539 3.44398 6.69754 3.26846 7.00119C3.09294 7.30483 3.00036 7.6493 3 8.00002V16C3.00036 16.3508 3.09294 16.6952 3.26846 16.9989C3.44398 17.3025 3.69626 17.5547 4 17.73L11 21.73C11.304 21.9056 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9056 13 21.73L20 17.73C20.3037 17.5547 20.556 17.3025 20.7315 16.9989C20.9996 16.6952 21 16.3508 21 16V8.00002Z
                                                M3.3 7L12 12L20.7 7
                                                M12 22V12"
                                          Stroke="{StaticResource Brush.Status.Success}"
                                          Fill="Transparent"
                                          Width="32" Height="32"
                                          Stretch="Uniform"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="{lex:Loc Key=Dashboard_StartFromExistingHardwares}"
                                           Style="{StaticResource Typography.H4}"
                                           Foreground="{StaticResource Brush.Text.Primary}"
                                           HorizontalAlignment="Center"
                                           Margin="0,16,0,0"/>
                                <TextBlock Text="{lex:Loc Key=Dashboard_StartFromExistingHardwares_Description}"
                                           Style="{StaticResource Typography.Body}"
                                           Foreground="{StaticResource Brush.Text.Secondary}"
                                           HorizontalAlignment="Center"
                                           TextAlignment="Center"
                                           Margin="0,8,0,0"/>
                            </StackPanel>
                        </controls:DefaultWhiteCard.CardContent>
                    </controls:DefaultWhiteCard>
                </UniformGrid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>