<UserControl x:Class="EquipmentDesigner.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:lex="http://wpflocalizeextension.codeplex.com"
             xmlns:services="clr-namespace:EquipmentDesigner.Services"
             xmlns:converters="clr-namespace:EquipmentDesigner.Converters"
             xmlns:controls="clr-namespace:EquipmentDesigner.Controls"
             lex:LocalizeDictionary.DesignCulture="ko"
             lex:ResxLocalizationProvider.DefaultAssembly="EquipmentDesigner"
             lex:ResxLocalizationProvider.DefaultDictionary="Resources.Strings"
             mc:Ignorable="d"
             Background="{StaticResource Brush.Background.Secondary}"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ComponentStateToBackgroundConverter x:Key="ComponentStateToBackgroundConverter"/>
        <converters:ComponentStateToForegroundConverter x:Key="ComponentStateToForegroundConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Bar with Language Selector -->
        <Border Grid.Row="0"
                Background="{StaticResource Brush.Surface.Primary}"
                BorderBrush="{StaticResource Brush.Border.Primary}"
                BorderThickness="0,0,0,1"
                Padding="24,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Header Section -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{lex:Loc Key=Dashboard_Title}"
                            Style="{StaticResource Typography.H3}"
                            Foreground="{StaticResource Brush.Text.Primary}"/>
                    <TextBlock Text="{lex:Loc Key=Dashboard_Subtitle}"
                            Style="{StaticResource Typography.Body.Large}"
                            Foreground="{StaticResource Brush.Text.Secondary}"
                            Margin="0,8,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1"/>

                <!-- Language Selector -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{lex:Loc Key=Language}"
                            Style="{StaticResource Typography.Body}"
                            Foreground="{StaticResource Brush.Text.Secondary}"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0"/>
                    <ComboBox Style="{StaticResource LanguageSelectorComboBox}"
                                ItemsSource="{Binding Source={x:Static services:LanguageService.Instance}, Path=AvailableLanguages}"
                                SelectedItem="{Binding Source={x:Static services:LanguageService.Instance}, Path=SelectedLanguage, Mode=TwoWay}"
                                DisplayMemberPath="DisplayName"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="{StaticResource Spacing.Padding.2XL}">
                <!-- Admin Mode Panel (Hidden by default, toggle with Ctrl+Shift+F10) -->
                <Border Background="{StaticResource Brush.Surface.Primary}"
                        BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                        BorderThickness="2"
                        CornerRadius="{StaticResource Radius.LG}"
                        Padding="16"
                        Margin="0,0,0,16"
                        Visibility="{Binding IsAdminModeVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                        MouseRightButtonUp="AdminPanel_MouseRightButtonUp">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Admin Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                            <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2v-2zm1-10c-1.66 0-3 1.34-3 3h2c0-.55.45-1 1-1s1 .45 1 1c0 1-1.5 1.25-1.5 3.5h2c0-1.5 1.5-1.75 1.5-3.5 0-1.66-1.34-3-3-3z"
                                  Fill="{StaticResource Brush.Status.Danger}"
                                  Width="20" Height="20"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Admin Mode"
                                       Style="{StaticResource Typography.Body.Large}"
                                       FontWeight="{StaticResource Font.Weight.SemiBold}"
                                       Foreground="{StaticResource Brush.Status.Danger}"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="(Ctrl+Shift+F10 to hide)"
                                       Style="{StaticResource Typography.Body.Small}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       VerticalAlignment="Center"
                                       Margin="12,0,0,0"/>
                        </StackPanel>

                        <!-- Admin Actions - WrapPanel for extensibility -->
                        <WrapPanel Grid.Row="1" Orientation="Horizontal">
                            <Button Command="{Binding DeleteAllIncompleteWorkflowsCommand}"
                                    Background="{StaticResource Brush.Status.Danger.Background}"
                                    BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                    BorderThickness="{StaticResource Border.Thin}"
                                    Padding="12,8"
                                    Margin="0,0,8,8"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{StaticResource Brush.Status.Danger.Background}"
                                                            BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                                            BorderThickness="{StaticResource Border.Thin}"
                                                            CornerRadius="{StaticResource Radius.MD}"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource Brush.Status.Danger.Border}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.5"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                          Fill="{StaticResource Brush.Status.Danger}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Delete All Incomplete Workflows"
                                               Style="{StaticResource Typography.Body}"
                                               Foreground="{StaticResource Brush.Status.Danger}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- Reset All Data Button -->
                            <Button Command="{Binding ResetAllDataCommand}"
                                    Background="{StaticResource Brush.Status.Danger.Background}"
                                    BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                    BorderThickness="{StaticResource Border.Thin}"
                                    Padding="12,8"
                                    Margin="0,0,8,8"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="ButtonBorder"
                                                            Background="{StaticResource Brush.Status.Danger.Background}"
                                                            BorderBrush="{StaticResource Brush.Status.Danger.Border}"
                                                            BorderThickness="{StaticResource Border.Thin}"
                                                            CornerRadius="{StaticResource Radius.MD}"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ButtonBorder" Property="Background" Value="{StaticResource Brush.Status.Danger.Border}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.5"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                          Fill="{StaticResource Brush.Status.Danger}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Reset All Data"
                                               Style="{StaticResource Typography.Body}"
                                               Foreground="{StaticResource Brush.Status.Danger}"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>
                    </Grid>
                </Border>

                <!-- Incomplete Workflows Section -->
                <Border Background="{StaticResource Brush.Status.Warning.Background}"
                        BorderBrush="{StaticResource Brush.Status.Warning.Border}"
                        BorderThickness="{StaticResource Border.Thin}"
                        CornerRadius="{StaticResource Radius.LG}"
                        Padding="16"
                        Margin="0,0,0,32"
                        Visibility="{Binding HasIncompleteWorkflows, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Warning Icon -->
                        <Path Grid.Column="0"
                              Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                              Fill="{StaticResource Brush.Status.Warning}"
                              Width="20" Height="20"
                              Stretch="Uniform"
                              VerticalAlignment="Top"
                              Margin="0,2,12,0"/>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="{lex:Loc Key=Dashboard_IncompleteWorkflows}"
                                       Style="{StaticResource Typography.Body.Large}"
                                       Foreground="{StaticResource Brush.Status.Warning}"
                                       FontWeight="{StaticResource Font.Weight.Medium}"/>
                            <TextBlock Text="{Binding IncompleteWorkflowsMessage}"
                                       Style="{StaticResource Typography.Body.Large}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       Margin="0,4,0,16"/>

                            <!-- Workflow Items List -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="256">
                                <ItemsControl ItemsSource="{Binding IncompleteWorkflows}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border x:Name="WorkflowItemBorder"
                                                    Background="{StaticResource Brush.Surface.Primary}"
                                                    BorderBrush="{StaticResource Brush.Border.Primary}"
                                                    BorderThickness="{StaticResource Border.Thin}"
                                                    CornerRadius="{StaticResource Radius.LG}"
                                                    Padding="12"
                                                    Margin="0,0,0,8"
                                                    Cursor="Hand">
                                                <Border.InputBindings>
                                                    <MouseBinding MouseAction="LeftClick"
                                                                  Command="{Binding DataContext.ResumeWorkflowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                  CommandParameter="{Binding}"/>
                                                </Border.InputBindings>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding StartedFrom}"
                                                                   Style="{StaticResource Typography.Body.Large}"
                                                                   Foreground="{StaticResource Brush.Text.Primary}"/>
                                                        <controls:StateChip Text="{Binding ComponentStateDisplayText}"
                                                                            ChipBackground="{Binding ComponentState, Converter={StaticResource ComponentStateToBackgroundConverter}}"
                                                                            ChipForeground="{Binding ComponentState, Converter={StaticResource ComponentStateToForegroundConverter}}"
                                                                            Margin="12,0,0,0"/>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding Date}"
                                                               Style="{StaticResource Typography.Body.Large}"
                                                               Foreground="{StaticResource Brush.Text.Secondary}"
                                                               VerticalAlignment="Center"/>

                                                    <!-- Delete Button (visible on hover) -->
                                                    <Button x:Name="DeleteButton"
                                                            Grid.Column="2"
                                                            Command="{Binding DataContext.DeleteWorkflowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            Background="Transparent"
                                                            BorderThickness="0"
                                                            Cursor="Hand"
                                                            Padding="6"
                                                            Margin="8,0,0,0"
                                                            Opacity="0"
                                                            VerticalAlignment="Center"
                                                            ToolTip="{lex:Loc Key=DeleteWorkflow_Tooltip}">
                                                        <Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"
                                                              Fill="{StaticResource Brush.Text.Secondary}"
                                                              Width="16" Height="16"
                                                              Stretch="Uniform"/>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                            <DataTemplate.Triggers>
                                                <Trigger SourceName="WorkflowItemBorder" Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="DeleteButton" Property="Opacity" Value="1"/>
                                                </Trigger>
                                                <Trigger SourceName="DeleteButton" Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="DeleteButton" Property="Opacity" Value="1"/>
                                                </Trigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Navigation Cards Section -->
                <UniformGrid Rows="1" Columns="2" Margin="0,0,0,32">
                    <!-- Create New Component Card -->
                    <Border BorderBrush="{StaticResource Brush.Border.Primary}"
                            BorderThickness="{StaticResource Border.Thin}"
                            CornerRadius="{StaticResource Radius.LG}"
                            Margin="0,0,16,0"
                            Cursor="Hand"
                            Height="140">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="{StaticResource Brush.Surface.Primary}"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource Brush.Status.Warning.Background}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding NavigateToCreateNewComponentCommand}"/>
                        </Border.InputBindings>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Path Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                  Fill="{StaticResource Brush.Text.Primary}"
                                  Width="32" Height="32"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"/>
                            <TextBlock Text="{lex:Loc Key=Dashboard_CreateNewComponent}"
                                       Style="{StaticResource Typography.H4}"
                                       Foreground="{StaticResource Brush.Text.Primary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,16,0,0"/>
                            <TextBlock Text="{lex:Loc Key=Dashboard_CreateNewComponent_Description}"
                                       Style="{StaticResource Typography.Body}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Component Lists Card -->
                    <Border BorderBrush="{StaticResource Brush.Border.Primary}"
                            BorderThickness="{StaticResource Border.Thin}"
                            CornerRadius="{StaticResource Radius.LG}"
                            Margin="16,0,0,0"
                            Cursor="Hand"
                            Height="140">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="{StaticResource Brush.Surface.Primary}"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource Brush.Status.Info.Background}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding NavigateToComponentListCommand}"/>
                        </Border.InputBindings>
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Path Data="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"
                                  Fill="{StaticResource Brush.Text.Primary}"
                                  Width="32" Height="32"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"/>
                            <TextBlock Text="{lex:Loc Key=Dashboard_ComponentLists}"
                                       Style="{StaticResource Typography.H4}"
                                       Foreground="{StaticResource Brush.Text.Primary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,16,0,0"/>
                            <TextBlock Text="{lex:Loc Key=Dashboard_ComponentLists_Description}"
                                       Style="{StaticResource Typography.Body}"
                                       Foreground="{StaticResource Brush.Text.Secondary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
