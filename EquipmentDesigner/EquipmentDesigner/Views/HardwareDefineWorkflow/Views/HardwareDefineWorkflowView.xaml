<UserControl x:Class="EquipmentDesigner.Views.HardwareDefineWorkflow.HardwareDefineWorkflowView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow"
             xmlns:equipment="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.EquipmentDefine"
             xmlns:system="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.SystemDefine"
             xmlns:unit="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.UnitDefine"
             xmlns:device="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.DeviceDefine"
             xmlns:models="clr-namespace:EquipmentDesigner.Models"
             xmlns:lex="http://wpflocalizeextension.codeplex.com"
             lex:LocalizeDictionary.DesignCulture="ko"
             lex:ResxLocalizationProvider.DefaultAssembly="EquipmentDesigner"
             lex:ResxLocalizationProvider.DefaultDictionary="Resources.Strings"
             mc:Ignorable="d"
             Background="{StaticResource Brush.Background.Primary}"
             d:DesignHeight="800" d:DesignWidth="1200">

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Left Navigation Panel -->
            <ColumnDefinition Width="300"/>
            <!-- Main Content Area -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Navigation Panel -->
        <Border Grid.Column="0"
                Background="{StaticResource Brush.Surface.Primary}"
                BorderBrush="{StaticResource Brush.Border.Primary}"
                BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Exit Button at Bottom -->
                <Button DockPanel.Dock="Bottom"
                        Command="{Binding ExitToDashboardCommand}"
                        Background="{StaticResource Brush.Button.Ghost.Background}"
                        BorderThickness="0"
                        Cursor="Hand"
                        Padding="16,12"
                        HorizontalContentAlignment="Left">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M10 19l-7-7m0 0l7-7m-7 7h18"
                              Stroke="{StaticResource Brush.Text.Secondary}"
                              StrokeThickness="2"
                              Width="16" Height="16"
                              Stretch="Uniform"
                              VerticalAlignment="Center"/>
                        <TextBlock Text="{lex:Loc Key=Workflow_ExitToDashboard}"
                                   Style="{StaticResource Typography.Body}"
                                   Foreground="{StaticResource Brush.Text.Secondary}"
                                   Margin="12,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Header Section -->
                <StackPanel DockPanel.Dock="Top" Margin="16,24,16,24">
                    <TextBlock Text="{lex:Loc Key=Workflow_HardwareDefinition}"
                               Style="{StaticResource Typography.H4}"
                               Foreground="{StaticResource Brush.Text.Primary}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="{lex:Loc Key=Workflow_CreatingFrom}"
                                   Style="{StaticResource Typography.Body.Small}"
                                   Foreground="{StaticResource Brush.Text.Secondary}"/>
                        <TextBlock Text="{Binding StartType}"
                                   Style="{StaticResource Typography.Body.Small}"
                                   Foreground="{StaticResource Brush.Text.Primary}"
                                   FontWeight="{StaticResource Font.Weight.Medium}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Workflow Steps - Tree Structure -->
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Margin="0,0,0,16">
                    <ItemsControl ItemsSource="{Binding TreeRootNodes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <local:HardwareTreeItemControl DataContext="{Binding}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Top Action Bar -->
            <Border Grid.Row="0"
                    Background="{StaticResource Brush.Surface.Primary}"
                    BorderBrush="{StaticResource Brush.Border.Primary}"
                    BorderThickness="0,0,0,1"
                    Padding="24,16">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <!-- Autosave Indicator -->
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,16,0"
                                Opacity="0">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsAutosaveIndicatorVisible}" Value="True">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                     To="1" Duration="0:0:0.2"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                     To="0" Duration="0:0:0.3"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <!-- Save Icon -->
                        <Viewbox Width="16" Height="16" VerticalAlignment="Center">
                            <Canvas Width="16" Height="16">
                                <!-- Outer save icon shape -->
                                <Path Data="M10.1333 2C10.485 2.00501 10.8205 2.14878 11.0667 2.4L13.6 4.93333C13.8512 5.17951 13.995 5.51497 14 5.86667V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H10.1333Z"
                                      Stroke="#64748B"
                                      StrokeThickness="1.33333"
                                      StrokeLineJoin="Round"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      Fill="Transparent"/>
                                <!-- Bottom content area -->
                                <Path Data="M11.3334 14.0001V9.33341C11.3334 9.1566 11.2632 8.98703 11.1382 8.86201C11.0131 8.73699 10.8436 8.66675 10.6667 8.66675H5.33341C5.1566 8.66675 4.98703 8.73699 4.86201 8.86201C4.73699 8.98703 4.66675 9.1566 4.66675 9.33341V14.0001"
                                      Stroke="#64748B"
                                      StrokeThickness="1.33333"
                                      StrokeLineJoin="Round"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      Fill="Transparent"/>
                                <!-- Top fold area -->
                                <Path Data="M4.66675 2V4.66667C4.66675 4.84348 4.73699 5.01305 4.86201 5.13807C4.98703 5.2631 5.1566 5.33333 5.33341 5.33333H10.0001"
                                      Stroke="#64748B"
                                      StrokeThickness="1.33333"
                                      StrokeLineJoin="Round"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      Fill="Transparent"/>
                            </Canvas>
                        </Viewbox>
                        <!-- Autosaved Text -->
                        <TextBlock Text="Autosaved"
                                   Style="{StaticResource Typography.Body.Small}"
                                   Foreground="#64748B"
                                   VerticalAlignment="Center"
                                   Margin="6,0,0,0"/>
                    </StackPanel>
                    <!-- Complete Workflow Button -->
                    <Button Command="{Binding CompleteWorkflowCommand}"
                            Padding="{StaticResource Spacing.Padding.Button}"
                            Height="{StaticResource Size.Button.Height.MD}"
                            BorderThickness="0"
                            Cursor="Hand"
                            Visibility="{Binding ShowUploadButton, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="{StaticResource Radius.LG}"/>
                            </Style>
                        </Button.Resources>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="{StaticResource Brush.Button.Success.Background}"/>
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Background" Value="{StaticResource Brush.Button.Disabled.Background}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M5 13l4 4L19 7"
                                  StrokeThickness="2"
                                  Width="16" Height="16"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center">
                                <Path.Style>
                                    <Style TargetType="Path">
                                        <Setter Property="Stroke" Value="{StaticResource Brush.Text.Inverse}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType=Button}}" Value="False">
                                                <Setter Property="Stroke" Value="{StaticResource Brush.Button.Disabled.Foreground}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                            <TextBlock Text="{lex:Loc Key=Device_CompleteWorkflow}"
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource Typography.Button}">
                                        <Setter Property="Foreground" Value="{StaticResource Brush.Text.Inverse}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType=Button}}" Value="False">
                                                <Setter Property="Foreground" Value="{StaticResource Brush.Button.Disabled.Foreground}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Button>
                  
                </StackPanel>
            </Border>

            <!-- Content Area -->
            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ContentControl Content="{Binding SelectedTreeNode.DataViewModel}"
                                Margin="{StaticResource Spacing.Padding.2XL}">
                    <ContentControl.Resources>
                        <DataTemplate DataType="{x:Type local:EquipmentDefineViewModel}">
                            <equipment:EquipmentDefineView />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type local:SystemDefineViewModel}">
                            <system:SystemDefineView />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type local:UnitDefineViewModel}">
                            <unit:UnitDefineView />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type local:DeviceDefineViewModel}">
                            <device:DeviceDefineView />
                        </DataTemplate>
                    </ContentControl.Resources>
                </ContentControl>
            </ScrollViewer>

            <!-- Bottom Navigation Bar -->
            <Border Grid.Row="2"
                    Background="{StaticResource Brush.Surface.Primary}"
                    BorderBrush="{StaticResource Brush.Border.Primary}"
                    BorderThickness="0,1,0,0"
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Edit Button (visible in read-only mode) -->
                    <Button Grid.Column="0"
                            Command="{Binding EnableEditCommand}"
                            Padding="{StaticResource Spacing.Padding.Button.Large}"
                            MinWidth="100"
                            Height="{StaticResource Size.Button.Height.LG}"
                            Background="{StaticResource Brush.Status.Warning.Background}"
                            BorderBrush="{StaticResource Brush.Status.Warning.Border}"
                            BorderThickness="1"
                            Cursor="Hand"
                            Margin="12,0,0,0"
                            Visibility="{Binding IsEditButtonVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7 M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                                  Stroke="{StaticResource Brush.Status.Warning}"
                                  StrokeThickness="2"
                                  Width="16" Height="16"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"/>
                            <TextBlock Text="{lex:Loc Key=Workflow_Edit}"
                                       Style="{StaticResource Typography.Button}"
                                       Foreground="{StaticResource Brush.Status.Warning}"
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Next Button -->
                    <Button Grid.Column="2"
                            Command="{Binding GoToNextStepCommand}"
                            Padding="{StaticResource Spacing.Padding.Button.Large}"
                            MinWidth="120"
                            Height="{StaticResource Size.Button.Height.LG}"
                            Background="{StaticResource Brush.Button.Primary.Background}"
                            BorderThickness="0"
                            Cursor="Hand"
                            Visibility="{Binding IsLastStep, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{lex:Loc Key=Workflow_Next}"
                                       Style="{StaticResource Typography.Button}"
                                       Foreground="{StaticResource Brush.Text.Inverse}"
                                       VerticalAlignment="Center"/>
                            <Path Data="M9 5l7 7-7 7"
                                  Stroke="{StaticResource Brush.Text.Inverse}"
                                  StrokeThickness="2"
                                  Width="16" Height="16"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  Margin="8,0,0,0"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>