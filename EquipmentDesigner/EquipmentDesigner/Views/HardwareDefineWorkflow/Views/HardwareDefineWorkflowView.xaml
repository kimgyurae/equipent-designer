<UserControl x:Class="EquipmentDesigner.Views.HardwareDefineWorkflow.HardwareDefineWorkflowView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow"
             xmlns:equipment="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.EquipmentDefine"
             xmlns:system="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.SystemDefine"
             xmlns:unit="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.UnitDefine"
             xmlns:device="clr-namespace:EquipmentDesigner.Views.HardwareDefineWorkflow.DeviceDefine"
             xmlns:models="clr-namespace:EquipmentDesigner.Models"
             xmlns:lex="http://wpflocalizeextension.codeplex.com"
             lex:LocalizeDictionary.DesignCulture="ko"
             lex:ResxLocalizationProvider.DefaultAssembly="EquipmentDesigner"
             lex:ResxLocalizationProvider.DefaultDictionary="Resources.Strings"
             mc:Ignorable="d"
             Background="{StaticResource Brush.Background.Primary}"
             d:DesignHeight="800" d:DesignWidth="1200">

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Left Navigation Panel -->
            <ColumnDefinition Width="300"/>
            <!-- Main Content Area -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Navigation Panel -->
        <Border Grid.Column="0"
                Background="{StaticResource Brush.Surface.Primary}"
                BorderBrush="{StaticResource Brush.Border.Primary}"
                BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Exit Button at Bottom -->
                <Button DockPanel.Dock="Bottom"
                        Command="{Binding ExitToDashboardCommand}"
                        Background="{StaticResource Brush.Button.Ghost.Background}"
                        BorderThickness="0"
                        Cursor="Hand"
                        Padding="16,12"
                        HorizontalContentAlignment="Left">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M10 19l-7-7m0 0l7-7m-7 7h18"
                              Stroke="{StaticResource Brush.Text.Secondary}"
                              StrokeThickness="2"
                              Width="16" Height="16"
                              Stretch="Uniform"
                              VerticalAlignment="Center"/>
                        <TextBlock Text="{lex:Loc Key=Workflow_ExitToDashboard}"
                                   Style="{StaticResource Typography.Body}"
                                   Foreground="{StaticResource Brush.Text.Secondary}"
                                   Margin="12,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Header Section -->
                <StackPanel DockPanel.Dock="Top" Margin="16,24,16,24">
                    <TextBlock Text="{lex:Loc Key=Workflow_HardwareDefinition}"
                               Style="{StaticResource Typography.H4}"
                               Foreground="{StaticResource Brush.Text.Primary}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="{lex:Loc Key=Workflow_CreatingFrom}"
                                   Style="{StaticResource Typography.Body.Small}"
                                   Foreground="{StaticResource Brush.Text.Secondary}"/>
                        <TextBlock Text="{Binding StartType}"
                                   Style="{StaticResource Typography.Body.Small}"
                                   Foreground="{StaticResource Brush.Text.Primary}"
                                   FontWeight="{StaticResource Font.Weight.Medium}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Workflow Steps - Tree Structure -->
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Margin="0,0,0,16">
                    <ItemsControl ItemsSource="{Binding TreeRootNodes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <local:HardwareTreeItemControl DataContext="{Binding}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Content Area -->
            <ScrollViewer Grid.Row="0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ContentControl Content="{Binding CurrentHardwareLayer}"
                                Margin="{StaticResource Spacing.Padding.2XL}">
                    <ContentControl.Resources>
                        <DataTemplate x:Key="EquipmentTemplate">
                            <equipment:EquipmentDefineView DataContext="{Binding DataContext.EquipmentViewModel, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </DataTemplate>
                        <DataTemplate x:Key="SystemTemplate">
                            <system:SystemDefineView DataContext="{Binding DataContext.SystemViewModel, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </DataTemplate>
                        <DataTemplate x:Key="UnitTemplate">
                            <unit:UnitDefineView DataContext="{Binding DataContext.UnitViewModel, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </DataTemplate>
                        <DataTemplate x:Key="DeviceTemplate">
                            <device:DeviceDefineView DataContext="{Binding DataContext.DeviceViewModel, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </DataTemplate>
                    </ContentControl.Resources>
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Static models:HardwareLayer.Equipment}">
                                    <Setter Property="ContentTemplate" Value="{StaticResource EquipmentTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Static models:HardwareLayer.System}">
                                    <Setter Property="ContentTemplate" Value="{StaticResource SystemTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Static models:HardwareLayer.Unit}">
                                    <Setter Property="ContentTemplate" Value="{StaticResource UnitTemplate}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Static models:HardwareLayer.Device}">
                                    <Setter Property="ContentTemplate" Value="{StaticResource DeviceTemplate}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </ScrollViewer>

            <!-- Bottom Navigation Bar -->
            <Border Grid.Row="1"
                    Background="{StaticResource Brush.Surface.Primary}"
                    BorderBrush="{StaticResource Brush.Border.Primary}"
                    BorderThickness="0,1,0,0"
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Edit Button (visible in read-only mode) -->
                    <Button Grid.Column="0"
                            Command="{Binding EnableEditCommand}"
                            Padding="{StaticResource Spacing.Padding.Button.Large}"
                            MinWidth="100"
                            Height="{StaticResource Size.Button.Height.LG}"
                            Background="{StaticResource Brush.Status.Warning.Background}"
                            BorderBrush="{StaticResource Brush.Status.Warning.Border}"
                            BorderThickness="1"
                            Cursor="Hand"
                            Margin="12,0,0,0"
                            Visibility="{Binding IsEditButtonVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7 M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                                  Stroke="{StaticResource Brush.Status.Warning}"
                                  StrokeThickness="2"
                                  Width="16" Height="16"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"/>
                            <TextBlock Text="{lex:Loc Key=Workflow_Edit}"
                                       Style="{StaticResource Typography.Button}"
                                       Foreground="{StaticResource Brush.Status.Warning}"
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Next Button -->
                    <Button Grid.Column="2"
                            Command="{Binding GoToNextStepCommand}"
                            Padding="{StaticResource Spacing.Padding.Button.Large}"
                            MinWidth="120"
                            Height="{StaticResource Size.Button.Height.LG}"
                            Background="{StaticResource Brush.Button.Primary.Background}"
                            BorderThickness="0"
                            Cursor="Hand"
                            Visibility="{Binding IsLastStep, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{lex:Loc Key=Workflow_Next}"
                                       Style="{StaticResource Typography.Button}"
                                       Foreground="{StaticResource Brush.Text.Inverse}"
                                       VerticalAlignment="Center"/>
                            <Path Data="M9 5l7 7-7 7"
                                  Stroke="{StaticResource Brush.Text.Inverse}"
                                  StrokeThickness="2"
                                  Width="16" Height="16"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  Margin="8,0,0,0"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>